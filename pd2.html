<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JioHotstar Pro Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #0078ff; --bg: #030b17; --text: #fff; --text-dim: #949ba3; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); font-family: 'Segoe UI', sans-serif; overflow: hidden; color: var(--text); }

        .app-root { display: flex; flex-direction: column; height: 100vh; }
        .player-box { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; overflow: hidden; }
        
        @media (orientation: landscape) {
            .player-box { height: 100vh; aspect-ratio: unset; }
            .info-section { display: none; }
        }

        video { width: 100%; height: 100%; object-fit: contain; transition: transform 0.3s ease; }
        video.zoomed { object-fit: cover; }

        /* Overlays */
        .overlay { position: absolute; inset: 0; z-index: 10; background: linear-gradient(to bottom, rgba(0,0,0,0.4) 0%, transparent 25%, transparent 75%, rgba(0,0,0,0.6) 100%); display: flex; flex-direction: column; justify-content: space-between; transition: opacity 0.3s; }
        .overlay.hidden { opacity: 0; pointer-events: none; }
        .overlay.locked { opacity: 0; pointer-events: none; }

        .top-nav { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .top-nav i { font-size: 20px; cursor: pointer; }
        .center-ui { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .play-icon { font-size: 55px; opacity: 0.9; cursor: pointer; }

        /* Progress Bar & Seek */
        .bottom-ui { padding: 0 20px 20px; }
        .live-status { display: flex; justify-content: flex-end; align-items: center; gap: 6px; font-size: 11px; font-weight: 800; color: #ff0000; margin-bottom: 10px; }
        .live-dot { width: 6px; height: 6px; background: #ff0000; border-radius: 50%; }

        .progress-area { width: 100%; height: 20px; display: flex; align-items: center; cursor: pointer; }
        .progress-bar-bg { width: 100%; height: 3px; background: rgba(255,255,255,0.2); position: relative; border-radius: 2px; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; position: relative; border-radius: 2px; }
        .progress-knob { position: absolute; right: -5px; top: -4px; width: 11px; height: 11px; background: #fff; border-radius: 50%; display: none; }
        .progress-area:hover .progress-knob { display: block; }

        /* Settings */
        .settings-view { position: absolute; inset: 0; background: rgba(3,11,23,0.98); z-index: 100; display: none; flex-direction: column; padding: 25px 8%; }
        .set-tabs { display: flex; gap: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 20px; }
        .tab { font-weight: 700; color: var(--text-dim); cursor: pointer; }
        .tab.active { color: #fff; border-bottom: 2px solid #fff; padding-bottom: 8px; }
        .opt { padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .opt.selected { color: var(--primary); font-weight: 700; }

        /* Info Section */
        .info-section { padding: 25px 20px; }
        .info-section h2 { margin: 0; font-size: 20px; font-weight: 700; }
        .info-section p { margin: 5px 0 0; color: var(--text-dim); font-size: 14px; }

        /* Gestures */
        .g-bar { position: absolute; top: 50%; transform: translateY(-50%); width: 3px; height: 120px; background: rgba(255,255,255,0.2); opacity: 0; transition: 0.2s; z-index: 5; }
        .g-fill { position: absolute; bottom: 0; width: 100%; background: var(--primary); }
        #toast { position: absolute; top: 15%; left: 50%; transform: translateX(-50%); background: var(--primary); padding: 8px 20px; border-radius: 20px; font-size: 13px; opacity: 0; transition: 0.3s; z-index: 200; }
        #loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; border: 4px solid rgba(0,120,255,0.1); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; display: none; z-index: 50; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #brOverlay { position: absolute; inset: 0; background: #000; opacity: 0; pointer-events: none; z-index: 2; }
        #lockBtn { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); z-index: 50; font-size: 22px; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 50%; display: none; }
    </style>
</head>
<body>

<div class="app-root">
    <div class="player-box" id="playerWrap">
        <div id="brOverlay"></div>
        <div id="loader"></div>
        <div id="toast"></div>

        <div class="g-bar" id="lBar" style="left: 10px;"><div class="g-fill" id="lFill"></div></div>
        <div class="g-bar" id="rBar" style="right: 10px;"><div class="g-fill" id="rFill"></div></div>

        <video id="v" playsinline crossorigin="anonymous"></video>

        <i class="fas fa-lock" id="lockBtn" onclick="toggleLock(event)"></i>

        <div class="settings-view" id="settings">
            <div class="set-tabs">
                <div class="tab active" id="tabQ" onclick="switchTab('quality')">Quality</div>
                <div class="tab" id="tabA" onclick="switchTab('audio')">Audio</div>
                <div style="flex-grow:1; text-align:right;"><i class="fas fa-times" onclick="closeSet()" style="cursor:pointer;"></i></div>
            </div>
            <div id="optList"></div>
        </div>

        <div class="overlay" id="ui">
            <div class="top-nav">
                <i class="fas fa-arrow-left" onclick="history.back()"></i>
                <div style="display:flex; gap: 25px;">
                    <i class="fas fa-lock" onclick="toggleLock(event)"></i>
                    <i class="fas fa-cog" onclick="openSet(event)"></i>
                    <i class="fas fa-expand" onclick="toggleFS()"></i>
                </div>
            </div>
            <div class="center-ui" onclick="togglePlay()"><i class="fas fa-pause play-icon" id="pI"></i></div>
            <div class="bottom-ui">
                <div class="live-status"><div class="live-dot"></div> LIVE</div>
                <div class="progress-area" id="progressArea">
                    <div class="progress-bar-bg"><div class="progress-fill" id="pFill"><div class="progress-knob"></div></div></div>
                </div>
            </div>
        </div>
    </div>

    <div class="info-section">
        <h2 id="nameTxt">Channel Name</h2>
        <p id="langTxt">Language</p>
    </div>
</div>

<script>
    const v = document.getElementById('v'), player = document.getElementById('playerWrap'), hls = new Hls({ lowLatencyMode: true });
    let uiTimer, isLocked = false, activeTab = 'quality', br = 1, initialPinchDist = null;

    // 1. URL Logic
    const params = new URLSearchParams(window.location.search);
    const src = params.get('src') || "https://d2jso9g61rg1h8.cloudfront.net/index_3.m3u8";
    document.getElementById('nameTxt').innerText = params.get('name') || "Star Utsav";
    document.getElementById('langTxt').innerText = params.get('lang') || "Hindi";

    if (Hls.isSupported()) {
        hls.loadSource(src); hls.attachMedia(v);
        hls.on(Hls.Events.MANIFEST_PARSED, () => v.play());
        hls.on(Hls.Events.FRAG_BUFFERING, () => document.getElementById('loader').style.display='block');
        hls.on(Hls.Events.FRAG_BUFFERED, () => document.getElementById('loader').style.display='none');
    }

    // 2. Workable Progress Bar
    const progressArea = document.getElementById('progressArea');
    const pFill = document.getElementById('pFill');

    function updateProgressBar() {
        if (v.duration) {
            const pct = (v.currentTime / v.duration) * 100;
            pFill.style.width = pct + '%';
        }
    }
    v.addEventListener('timeupdate', updateProgressBar);

    progressArea.addEventListener('click', (e) => {
        if (isLocked) return;
        const rect = progressArea.getBoundingClientRect();
        const pos = (e.clientX - rect.left) / rect.width;
        v.currentTime = pos * v.duration;
    });

    // 3. Picture-in-Picture Logic
    document.addEventListener("visibilitychange", () => {
        if (document.visibilityState === "hidden" && !v.paused) {
            if (v.requestPictureInPicture) v.requestPictureInPicture().catch(()=>{});
        }
    });

    // 4. Gestures (Pitch to Scale & Volume/Brightness)
    player.addEventListener('touchstart', e => {
        if (isLocked) return;
        if (e.touches.length === 2) {
            initialPinchDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
        } else {
            this.sy = e.touches[0].pageY; this.sx = e.touches[0].pageX;
        }
    }, {passive:true});

    player.addEventListener('touchmove', e => {
        if (isLocked) return;
        // Pinch to Scale
        if (e.touches.length === 2 && initialPinchDist) {
            const currentDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
            if (currentDist > initialPinchDist + 40) { v.classList.add('zoomed'); showToast("Zoomed to Fill"); }
            if (currentDist < initialPinchDist - 40) { v.classList.remove('zoomed'); showToast("Original Size"); }
        } 
        // Volume / Brightness
        else if (e.touches.length === 1) {
            const dy = (this.sy - e.touches[0].pageY) / 250;
            if (this.sx < window.innerWidth / 2) {
                br = Math.min(Math.max(br + dy, 0), 1);
                document.getElementById('brOverlay').style.opacity = 1 - br;
                showG('lBar', 'lFill', br);
            } else {
                v.volume = Math.min(Math.max(v.volume + dy, 0), 1);
                showG('rBar', 'rFill', v.volume);
            }
            this.sy = e.touches[0].pageY;
        }
    }, {passive:true});

    function showG(b, f, v) {
        const bar = document.getElementById(b); bar.style.opacity = 1;
        document.getElementById(f).style.height = (v*100)+'%';
        clearTimeout(this.gt); this.gt = setTimeout(() => bar.style.opacity = 0, 1000);
    }

    // 5. Settings & UI
    function togglePlay() { v.paused ? v.play() : v.pause(); document.getElementById('pI').className = v.paused ? 'fas fa-play play-icon' : 'fas fa-pause play-icon'; }
    function openSet(e) { e.stopPropagation(); document.getElementById('settings').style.display='flex'; renderOpts(); }
    function closeSet() { document.getElementById('settings').style.display='none'; }
    function switchTab(t) { activeTab = t; document.getElementById('tabQ').classList.toggle('active', t==='quality'); document.getElementById('tabA').classList.toggle('active', t==='audio'); renderOpts(); }
    
    function renderOpts() {
        const list = document.getElementById('optList'); list.innerHTML = '';
        if (activeTab === 'quality') {
            list.innerHTML += `<div class="opt ${hls.currentLevel===-1?'selected':''}" onclick="hls.currentLevel=-1;closeSet()">Auto<i class="fas fa-check"></i></div>`;
            hls.levels.forEach((l, i) => list.innerHTML += `<div class="opt ${hls.currentLevel===i?'selected':''}" onclick="hls.currentLevel=${i};closeSet()">${l.height}p<i class="fas fa-check"></i></div>`);
        } else {
            hls.audioTracks.forEach((t, i) => list.innerHTML += `<div class="opt ${hls.audioTrack===i?'selected':''}" onclick="hls.audioTrack=${i};closeSet()">${t.name}<i class="fas fa-check"></i></div>`);
        }
    }

    function toggleLock(e) { e.stopPropagation(); isLocked = !isLocked; document.getElementById('ui').classList.toggle('locked', isLocked); document.getElementById('lockBtn').style.display = isLocked ? 'block' : 'none'; showToast(isLocked ? "Screen Locked" : "Unlocked"); }
    function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.opacity = 1; setTimeout(() => t.style.opacity = 0, 2000); }
    
    player.onclick = () => { if (isLocked) return; document.getElementById('ui').classList.remove('hidden'); clearTimeout(uiTimer); uiTimer = setTimeout(() => { if (!v.paused) document.getElementById('ui').classList.add('hidden'); }, 4000); };
    
    async function toggleFS() {
        if (!document.fullscreenElement) {
            await player.requestFullscreen();
            if (screen.orientation && screen.orientation.lock) screen.orientation.lock('landscape').catch(()=>{});
        } else { document.exitFullscreen(); }
    }
</script>
</body>
</html>