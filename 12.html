<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Channel Registration - Anthropic</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --primary: #10a37f; --bg: #f9fafb; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; min-height: 100vh; }
        .hero { flex: 1; background: #000; color: white; display: flex; align-items: center; justify-content: center; padding: 40px; text-align: center; }
        .form-area { flex: 1.5; background: white; padding: 50px; }
        .container { max-width: 600px; margin: auto; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: 600; font-size: 0.8rem; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .locked { background: #f0f0f0; color: #666; cursor: not-allowed; border: 1px dashed #ccc; font-weight: bold; }
        .btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        #msg { padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; text-align: center; font-weight: bold; }
        .success { background: #dcfce7; color: #15803d; }
        .error { background: #fee2e2; color: #b91c1c; }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    </style>
</head>
<body>

<div class="hero">
    <div>
        <h1 style="color: var(--primary)">Anthropic Media</h1>
        <p>Register your broadcast channels into the TRAIPCL Database.</p>
    </div>
</div>

<div class="form-area">
    <div class="container">
        <div id="msg"></div>
        <form id="channelForm">
            <h2>Channel Registration</h2>
            
            <div class="input-group">
                <label>Channel Name</label>
                <input type="text" id="chName" required>
            </div>

            <div class="row">
                <div class="input-group">
                    <label>Logo URL</label>
                    <input type="url" id="chUrl" required>
                </div>
                <div class="input-group">
                    <label>Logo JPG (File Name)</label>
                    <input type="text" id="chJpg" required>
                </div>
            </div>

            <div class="row">
                <div class="input-group">
                    <label>Category</label>
                    <select id="chCat" required>
                        <option>Sports</option><option>Entertainment</option><option>News</option>
                        <option>Infotainment</option><option>Kids</option><option>Movies</option>
                        <option>Music</option><option>Spiritual</option><option>Knowledge</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Audio Language</label>
                    <select id="chAud" required>
                        <option>Hindi</option><option>English</option><option>Tamil</option>
                        <option>Telugu</option><option>Kannada</option><option>Malayalam</option>
                        <option>Punjabi</option><option>Marathi</option><option>Gujrati</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>Definition</label>
                <select id="chDef"><option>SD</option><option>HD</option><option>4K</option></select>
            </div>

            <div class="input-group">
                <label>Parent Organization (Auto-filled)</label>
                <input type="text" id="chParent" class="locked" readonly>
            </div>

            <div class="input-group">
                <label>Anthropic Media Partner Key (Auto-filled)</label>
                <input type="text" id="chKey" class="locked" readonly>
            </div>

            <button type="submit" class="btn">Register Channel to TRAIPCL</button>
        </form>
    </div>
</div>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyDPm2za3Ho0Hd8Henuhq0KxAHyUQh-Hi-U",
        authDomain: "question-metabase.firebaseapp.com",
        projectId: "question-metabase",
        storageBucket: "question-metabase.firebasestorage.app",
        messagingSenderId: "770698198753",
        appId: "1:770698198753:web:59ae49d78b6013bab5c1a0"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- AUTO-FILL LOGIC ---
    window.onload = function() {
        const org = localStorage.getItem('active_org');
        const key = localStorage.getItem('active_key');

        if (org && key) {
            document.getElementById('chParent').value = org;
            document.getElementById('chKey').value = key;
        } else {
            alert("No partner session found. Please login first.");
            window.location.href = "login.html"; // Redirect back to login if empty
        }
    };

    // --- FORM SUBMISSION ---
    document.getElementById('channelForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const msg = document.getElementById('msg');
        
        const data = {
            channelName: document.getElementById('chName').value,
            logoUrl: document.getElementById('chUrl').value,
            logoJpg: document.getElementById('chJpg').value,
            category: document.getElementById('chCat').value,
            audio: document.getElementById('chAud').value,
            definition: document.getElementById('chDef').value,
            parentOrganization: document.getElementById('chParent').value,
            partnerKey: document.getElementById('chKey').value,
            timestamp: new Date()
        };

        try {
            await db.collection("TRAIPCL").add(data);
            msg.innerText = "Success! Channel Registered.";
            msg.className = "success";
            msg.style.display = "block";
            e.target.reset();
            // Re-fill the locked fields after reset
            document.getElementById('chParent').value = data.parentOrganization;
            document.getElementById('chKey').value = data.partnerKey;
        } catch (err) {
            msg.innerText = "Error: " + err.message;
            msg.className = "error";
            msg.style.display = "block";
        }
    });
</script>
</body>
</html>
