<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JioHotstar Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --hotstar-blue: #0078ff; 
            --bg-navy: #030b17; 
            --text-main: #ffffff;
            --text-dim: #949ba3;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg-navy); font-family: 'Inter', -apple-system, sans-serif; overflow: hidden; color: var(--text-main); }

        .app-root { display: flex; flex-direction: column; height: 100vh; }

        /* VIDEO CONTAINER */
        .player-box { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; overflow: hidden; }
        
        /* Landscape Mode Fixes */
        @media (orientation: landscape) {
            .player-box { height: 100vh; aspect-ratio: unset; }
            .portrait-info { display: none; }
        }

        video { width: 100%; height: 100%; object-fit: contain; }

        /* OVERLAY GRADIENTS */
        .overlay { 
            position: absolute; inset: 0; z-index: 10; 
            background: linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, transparent 25%, transparent 75%, rgba(0,0,0,0.6) 100%);
            display: flex; flex-direction: column; justify-content: space-between;
            transition: opacity 0.3s ease;
        }
        .overlay.hidden { opacity: 0; pointer-events: none; }
        .overlay.locked { opacity: 0; pointer-events: none; }

        /* TOP NAVIGATION */
        .top-nav { padding: 12px 18px; display: flex; justify-content: space-between; align-items: center; }
        .top-nav i { font-size: 18px; color: #fff; cursor: pointer; opacity: 0.9; }
        .nav-right { display: flex; gap: 24px; align-items: center; }

        /* CENTER CONTROLS */
        .center-ui { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .play-pause-icon { font-size: 48px; color: #fff; opacity: 0.9; cursor: pointer; }

        /* BOTTOM PLAYER UI */
        .bottom-ui { padding: 0 18px 12px; }
        .live-status { display: flex; justify-content: flex-end; align-items: center; gap: 6px; font-size: 11px; font-weight: 800; color: #ff0000; margin-bottom: 8px; }
        .live-dot { width: 6px; height: 6px; background: #ff0000; border-radius: 50%; }
        
        /* THIN SEEKBAR */
        .seekbar-container { width: 100%; height: 2px; background: rgba(255,255,255,0.2); position: relative; }
        .seekbar-progress { height: 100%; background: var(--hotstar-blue); width: 100%; position: relative; }
        .seekbar-knob { position: absolute; right: -4px; top: -3px; width: 8px; height: 8px; background: #fff; border-radius: 50%; box-shadow: 0 0 5px rgba(0,0,0,0.5); }

        /* SETTINGS OVERLAY (Hotstar Tab Style) */
        .settings-view { 
            position: absolute; inset: 0; background: rgba(3,11,23,0.98); z-index: 100; 
            display: none; flex-direction: column; padding: 25px 8%; 
        }
        .set-header { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 12px; margin-bottom: 20px; }
        .set-tabs { display: flex; gap: 30px; }
        .set-tab { font-size: 16px; font-weight: 700; color: var(--text-dim); cursor: pointer; }
        .set-tab.active { color: #fff; border-bottom: 2px solid #fff; padding-bottom: 10px; }
        
        .opt-row { padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .opt-row i { color: var(--hotstar-blue); font-size: 14px; visibility: hidden; }
        .opt-row.active i { visibility: visible; }
        .opt-row.active b { color: var(--hotstar-blue); }

        /* PORTRAIT INFO SECTION */
        .portrait-info { padding: 20px 18px; }
        .portrait-info h2 { margin: 0; font-size: 19px; font-weight: 600; color: #fff; }
        .portrait-info p { margin: 5px 0 0; font-size: 14px; color: var(--text-dim); }

        /* GESTURE BARS (SIDE) */
        .side-gesture { position: absolute; top: 50%; transform: translateY(-50%); width: 2px; height: 100px; background: rgba(255,255,255,0.2); opacity: 0; transition: 0.2s; }
        .g-fill { position: absolute; bottom: 0; width: 100%; background: var(--hotstar-blue); }

        /* UTILS */
        #loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 35px; height: 35px; border: 3px solid rgba(0,120,255,0.1); border-top-color: var(--hotstar-blue); border-radius: 50%; animation: spin 0.8s linear infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #lockBtn { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); z-index: 50; font-size: 20px; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 50%; display: none; }
        #brOverlay { position: absolute; inset: 0; background: #000; opacity: 0; pointer-events: none; z-index: 5; }
    </style>
</head>
<body>

<div class="app-root">
    <div class="player-box" id="playerWrap">
        <div id="brOverlay"></div>
        <div id="loader"></div>
        
        <!-- Side Indicators -->
        <div class="side-gesture" id="lG" style="left: 10px;"><div class="g-fill" id="brF"></div></div>
        <div class="side-gesture" id="rG" style="right: 10px;"><div class="g-fill" id="volF"></div></div>

        <video id="v" playsinline crossorigin="anonymous"></video>

        <!-- Lock System -->
        <i class="fas fa-lock" id="lockBtn" onclick="toggleLock(event)"></i>

        <!-- Settings Modal -->
        <div class="settings-view" id="settings">
            <div class="set-header">
                <div class="set-tabs">
                    <div class="set-tab active" id="tabQ" onclick="switchTab('quality')">Quality</div>
                    <div class="set-tab" id="tabA" onclick="switchTab('audio')">Audio Language</div>
                </div>
                <div style="display:flex; gap: 20px; align-items:center;">
                    <span style="font-size: 13px; color: var(--text-dim);">Report an Issue</span>
                    <i class="fas fa-times" onclick="closeSet()" style="cursor:pointer; font-size: 20px;"></i>
                </div>
            </div>
            <div id="optList"></div>
        </div>

        <!-- Main UI -->
        <div class="overlay" id="ui">
            <div class="top-nav">
                <i class="fas fa-arrow-left" onclick="history.back()"></i>
                <div class="nav-right">
                    <i class="fas fa-broadcast-tower"></i>
                    <i class="fas fa-cog" onclick="openSet(event)"></i>
                    <i class="fas fa-expand" onclick="toggleFS()"></i>
                </div>
            </div>

            <div class="center-ui" onclick="togglePlay()">
                <i class="fas fa-pause play-pause-icon" id="playIcon"></i>
            </div>

            <div class="bottom-ui">
                <div class="live-status">
                    <div class="live-dot"></div> LIVE
                </div>
                <div class="seekbar-container">
                    <div class="seekbar-progress">
                        <div class="seekbar-knob"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Portrait Channel Info -->
    <div class="portrait-info">
        <h2 id="dispTitle">Live Stream</h2>
        <p id="dispLang">Hindi</p>
    </div>
</div>

<script>
    const v = document.getElementById('v'), hls = new Hls({ lowLatencyMode: true });
    let uiTimer, isLocked = false, activeTab = 'quality', br = 1;

    // URL Logic
    const params = new URLSearchParams(window.location.search);
    const src = params.get('src') || "https://d2jso9g61rg1h8.cloudfront.net/index_3.m3u8";
    const name = params.get('name') || "Star Utsav";
    const lang = params.get('lang') || "Hindi";

    document.getElementById('dispTitle').innerText = name;
    document.getElementById('dispLang').innerText = lang;

    if (Hls.isSupported()) {
        hls.loadSource(src); hls.attachMedia(v);
        hls.on(Hls.Events.MANIFEST_PARSED, () => { v.play(); handleLang(lang); });
        hls.on(Hls.Events.FRAG_BUFFERING, () => document.getElementById('loader').style.display='block');
        hls.on(Hls.Events.FRAG_BUFFERED, () => document.getElementById('loader').style.display='none');
    }

    // Settings Functionality
    function openSet(e) { e.stopPropagation(); document.getElementById('settings').style.display='flex'; renderOpts(); }
    function closeSet() { document.getElementById('settings').style.display='none'; }
    function switchTab(t) { activeTab = t; document.getElementById('tabQ').classList.toggle('active', t==='quality'); document.getElementById('tabA').classList.toggle('active', t==='audio'); renderOpts(); }

    function renderOpts() {
        const list = document.getElementById('optList'); list.innerHTML = '';
        if (activeTab === 'quality') {
            list.innerHTML += `<div class="opt-row ${hls.currentLevel === -1 ? 'active' : ''}" onclick="hls.currentLevel=-1;closeSet()"><b>Auto</b><i class="fas fa-check"></i></div>`;
            hls.levels.forEach((l, i) => {
                const isSel = hls.currentLevel === i;
                list.innerHTML += `<div class="opt-row ${isSel?'active':''}" onclick="hls.currentLevel=${i};closeSet()"><b>${l.height}p</b><i class="fas fa-check"></i></div>`;
            });
        } else {
            hls.audioTracks.forEach((t, i) => {
                const isSel = hls.audioTrack === i;
                list.innerHTML += `<div class="opt-row ${isSel?'active':''}" onclick="hls.audioTrack=${i};closeSet()"><b>${t.name}</b><i class="fas fa-check"></i></div>`;
            });
        }
    }

    function handleLang(t) {
        const idx = hls.audioTracks.findIndex(at => at.lang.includes(t) || at.name.toLowerCase().includes(t.toLowerCase()));
        if (idx !== -1) hls.audioTrack = idx;
    }

    // UI Logic
    function togglePlay() { 
        v.paused ? v.play() : v.pause(); 
        document.getElementById('playIcon').className = v.paused ? 'fas fa-play play-pause-icon' : 'fas fa-pause play-pause-icon';
    }

    function toggleLock(e) {
        e.stopPropagation();
        isLocked = !isLocked;
        document.getElementById('ui').classList.toggle('locked', isLocked);
        const lockBtn = document.getElementById('lockBtn');
        lockBtn.style.display = isLocked ? 'block' : 'none';
        lockBtn.className = isLocked ? 'fas fa-lock' : 'fas fa-unlock';
        if (!isLocked) showUI();
    }

    document.getElementById('playerWrap').onclick = () => {
        if (isLocked) { document.getElementById('lockBtn').style.display = 'block'; return; }
        showUI();
    };

    function showUI() {
        document.getElementById('ui').classList.remove('hidden');
        clearTimeout(uiTimer);
        uiTimer = setTimeout(() => { if (!v.paused) document.getElementById('ui').classList.add('hidden'); }, 3500);
    }

    // Gestures
    document.getElementById('playerWrap').addEventListener('touchstart', e => {
        if (isLocked) return;
        this.sy = e.touches[0].pageY; this.sx = e.touches[0].pageX;
    }, {passive:true});

    document.getElementById('playerWrap').addEventListener('touchmove', e => {
        if (isLocked || e.touches.length !== 1) return;
        const dy = (this.sy - e.touches[0].pageY) / 250;
        if (this.sx < window.innerWidth / 2) {
            br = Math.min(Math.max(br + dy, 0), 1);
            document.getElementById('brOverlay').style.opacity = 1 - br;
            updateG('lG', br);
        } else {
            v.volume = Math.min(Math.max(v.volume + dy, 0), 1);
            updateG('rG', v.volume);
        }
        this.sy = e.touches[0].pageY;
    }, {passive:true});

    function updateG(id, val) {
        const bar = document.getElementById(id);
        bar.style.opacity = 1;
        bar.querySelector('.g-fill').style.height = (val * 100) + '%';
        clearTimeout(this.gt); this.gt = setTimeout(() => bar.style.opacity = 0, 1000);
    }

    // Orientation Logic
    async function toggleFS() {
        if (!document.fullscreenElement) {
            await document.getElementById('playerWrap').requestFullscreen();
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('landscape').catch(() => {});
            }
        } else {
            document.exitFullscreen();
        }
    }
</script>
</body>
    </html>
