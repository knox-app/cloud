<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knox Console</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background: #f4f7f6; color: #333; display: flex; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }
        
        /* Auth Styles */
        #authSection { position: fixed; inset: 0; background: white; z-index: 100; display: flex; align-items: center; justify-content: center; overflow-y: auto; padding: 20px; }
        .auth-card { background: white; width: 100%; max-width: 500px; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #eee; }
        
        /* Dashboard Styles */
        aside { width: 260px; background: #fff; border-right: 1px solid #ddd; padding: 20px; display: flex; flex-direction: column; }
        main { flex: 1; background: #f9f9f9; overflow-y: auto; padding: 30px; }
        
        /* Form elements */
        input, select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        button { width: 100%; padding: 12px; background: #000; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button.sec { background: #eee; color: #333; margin-top: 10px; }

        .project-card { background: #fff; border: 1px solid #ddd; padding: 20px; border-radius: 10px; margin-bottom: 20px; position: relative; }
        .badge { position: absolute; top: 20px; right: 20px; background: #eef; font-size: 10px; padding: 4px 8px; border-radius: 4px; }
        .key-display { background: #f4f4f4; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; margin-top: 10px; word-break: break-all; border: 1px dashed #ccc; }
        
        /* Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 200; }
        .modal-content { background: #fff; padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; }
    </style>
</head>
<body>

    <!-- DEVELOPER AUTH -->
    <section id="authSection">
        <div class="auth-card">
            <h1 id="authTitle">Developer Registration</h1>
            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Store keys and manage your auth flow.</p>
            
            <form onsubmit="handleDevAuth(event)">
                <div id="signupOnly" class="flex" style="display:flex; gap:10px;">
                    <input name="fname" placeholder="First Name">
                    <input name="lname" placeholder="Last Name">
                </div>
                <div id="signupOnly2">
                    <input name="mobile" placeholder="Mobile Number">
                    <input name="pfp" placeholder="Profile Picture URL">
                    <label style="font-size:11px; font-weight:bold;">Date of Birth</label>
                    <input name="dob" type="date">
                </div>
                
                <input name="email" type="email" placeholder="Email ID" required>
                <input name="password" type="password" placeholder="Password" required>
                
                <button id="mainBtn">Create Account</button>
            </form>
            <button class="sec" onclick="toggleAuth()">Already have an account? Login</button>
        </div>
    </section>

    <!-- DEVELOPER DASHBOARD -->
    <aside>
        <h2 style="margin-bottom:30px;">Knox Cloud</h2>
        <nav>
            <p style="font-size:12px; color:#999; margin-bottom:10px;">MANAGEMENT</p>
            <div style="background:#f0f0f0; padding:10px; border-radius:5px; font-weight:bold; cursor:pointer;">API Projects</div>
        </nav>
        <div style="margin-top:auto; font-size:12px; color:#666;">
            Logged in as: <br> <b id="loggedInUser">...</b>
            <button class="sec" style="margin-top:10px; padding:5px;" onclick="logout()">Logout</button>
        </div>
    </aside>

    <main>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <h1>API Projects</h1>
            <button style="width:auto; padding:10px 20px;" onclick="showModal()">+ Create API</button>
        </div>

        <div id="projectList">
            <!-- Projects load here -->
        </div>
    </main>

    <!-- CREATE API MODAL -->
    <div id="apiModal" class="modal hidden">
        <div class="modal-content">
            <h3>Create New API Key</h3>
            <p style="font-size:12px; color:#666; margin-bottom:20px;">Use subdomains like app.example.com</p>
            
            <form onsubmit="createAPI(event)">
                <input id="apiName" placeholder="API Name (e.g. Production Login)" required>
                <input id="apiDomain" placeholder="Domain (e.g. example.abc.com)" required>
                <input id="apiFullUrl" placeholder="Full Redirect URL (https://site.com/2.html)" required>
                
                <label style="font-size:11px; font-weight:bold;">Authentication Requirement</label>
                <select id="apiMethod">
                    <option value="Email+Pass">Email + Password</option>
                    <option value="Email+OTP">Email + OTP</option>
                    <option value="Phone+Pass">Phone + Password</option>
                </select>

                <div id="otpConfig" style="background:#f9f9f9; padding:10px; border-radius:5px; margin-bottom:10px;">
                    <p style="font-size:10px; font-weight:bold; color:green; margin-bottom:5px;">OTP SETTINGS</p>
                    <input id="senderId" placeholder="Sender ID (e.g. SK-FBSWQ...)">
                    <input id="templateId" placeholder="Template ID (e.g. T-Q4QNI)">
                </div>

                <button>Generate API Key</button>
                <button type="button" class="sec" onclick="closeModal()">Cancel</button>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDPm2za3Ho0Hd8Henuhq0KxAHyUQh-Hi-U",
            authDomain: "question-metabase.firebaseapp.com",
            projectId: "question-metabase",
            storageBucket: "question-metabase.firebasestorage.app",
            messagingSenderId: "770698198753",
            appId: "1:770698198753:web:59ae49d78b6013bab5c1a0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let isLogin = false;
        window.toggleAuth = () => {
            isLogin = !isLogin;
            document.getElementById('authTitle').innerText = isLogin ? "Login" : "Developer Registration";
            document.getElementById('signupOnly').style.display = isLogin ? "none" : "flex";
            document.getElementById('signupOnly2').style.display = isLogin ? "none" : "block";
            document.getElementById('mainBtn').innerText = isLogin ? "Login" : "Create Account";
        }

        window.handleDevAuth = async (e) => {
            e.preventDefault();
            const fd = new FormData(e.target);
            const data = Object.fromEntries(fd.entries());
            
            // Logic: Store in Firestore. 
            // Real apps use Firebase Auth, but here we use Firestore per your request.
            await setDoc(doc(db, "developers", data.email), data);
            localStorage.setItem("dev_email", data.email);
            location.reload();
        };

        window.logout = () => { localStorage.clear(); location.reload(); };

        const devEmail = localStorage.getItem("dev_email");
        if(devEmail) {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('loggedInUser').innerText = devEmail;
            loadProjects();
        }

        window.showModal = () => document.getElementById('apiModal').classList.remove('hidden');
        window.closeModal = () => document.getElementById('apiModal').classList.add('hidden');

        window.createAPI = async (e) => {
            e.preventDefault();
            const key = "SK-" + Math.random().toString(36).toUpperCase().substr(2, 10);
            
            await addDoc(collection(db, "apps"), {
                owner: devEmail,
                name: document.getElementById('apiName').value,
                domain: document.getElementById('apiDomain').value,
                fullUrl: document.getElementById('apiFullUrl').value,
                method: document.getElementById('apiMethod').value,
                sender: document.getElementById('senderId').value,
                template: document.getElementById('templateId').value,
                apiKey: key
            });
            location.reload();
        }

        async function loadProjects() {
            const grid = document.getElementById('projectList');
            const q = query(collection(db, "apps"), where("owner", "==", devEmail));
            const snap = await getDocs(q);
            
            snap.forEach(doc => {
                const p = doc.data();
                grid.innerHTML += `
                    <div class="project-card">
                        <span class="badge">${p.method}</span>
                        <h3>${p.name}</h3>
                        <p style="font-size:12px; color:#666;">Domain: ${p.domain}</p>
                        <div class="key-display">API Key: ${p.apiKey}</div>
                    </div>
                `;
            });
        }
    </script>
</body>
    </html>t
