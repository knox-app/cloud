<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knox Dashboard</title>
    <style>
        * { box-sizing: border-box; font-family: sans-serif; }
        body { background: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background: white; padding: 30px; border-radius: 12px; width: 100%; max-width: 600px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; }
        button { width: 100%; padding: 12px; background: #000; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .project { border: 1px solid #eee; padding: 15px; margin-top: 15px; border-radius: 8px; background: #fafafa; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="authBox" class="container">
        <h2>Developer Auth</h2>
        <input id="devEmail" type="email" placeholder="Email">
        <input id="devPass" type="password" placeholder="Password">
        <button onclick="devLogin()">Login / Register</button>
    </div>

    <div id="dashBox" class="container hidden">
        <h2>Create API Project</h2>
        <input id="apiName" placeholder="Project Name">
        <input id="apiDomain" placeholder="Domain (example.abc.com)">
        <input id="fullUrl" placeholder="Redirect URL (https://site.com/home.html)">
        <input id="senderId" placeholder="Sender API Key (SK-...)">
        <input id="templateId" placeholder="Template ID (T-...)">
        <select id="method"><option value="Email+OTP">Email + OTP</option><option value="Email+Pass">Email + Password</option></select>
        <button onclick="createProject()">Generate API Key</button>
        <div id="projectList"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, collection, query, where, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDPm2za3Ho0Hd8Henuhq0KxAHyUQh-Hi-U",
            authDomain: "question-metabase.firebaseapp.com",
            projectId: "question-metabase",
            storageBucket: "question-metabase.firebasestorage.app",
            messagingSenderId: "770698198753",
            appId: "1:770698198753:web:59ae49d78b6013bab5c1a0"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.devLogin = async () => {
            const email = document.getElementById('devEmail').value;
            localStorage.setItem('knox_dev', email);
            await setDoc(doc(db, "developers", email), { email, lastLogin: new Date() }, { merge: true });
            location.reload();
        };

        const dev = localStorage.getItem('knox_dev');
        if(dev) {
            document.getElementById('authBox').classList.add('hidden');
            document.getElementById('dashBox').classList.remove('hidden');
            loadProjects();
        }

        window.createProject = async () => {
            const key = "SK-" + Math.random().toString(36).toUpperCase().substr(2, 10);
            await addDoc(collection(db, "apps"), {
                owner: dev,
                name: document.getElementById('apiName').value,
                domain: document.getElementById('apiDomain').value,
                fullUrl: document.getElementById('fullUrl').value,
                sender: document.getElementById('senderId').value,
                template: document.getElementById('templateId').value,
                method: document.getElementById('method').value,
                apiKey: key
            });
            location.reload();
        };

        async function loadProjects() {
            const q = query(collection(db, "apps"), where("owner", "==", dev));
            const snap = await getDocs(q);
            snap.forEach(d => {
                const p = d.data();
                document.getElementById('projectList').innerHTML += `<div class="project"><b>${p.name}</b><br>Key: <code>${p.apiKey}</code></div>`;
            });
        }
    </script>
</body>
</html>   </html>t
