<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Universal HLS Player</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{--p:#0078ff;--bg:#030b17;--t:#fff;--d:#9aa0a6}
*{-webkit-tap-highlight-color:transparent;box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--t);font-family:Segoe UI,sans-serif;overflow:hidden}
.player{position:relative;width:100%;height:100vh;background:#000}
video{width:100%;height:100%;object-fit:contain;background:#000}
.overlay{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:space-between;
background:linear-gradient(to bottom,rgba(0,0,0,.5),transparent 30%,transparent 70%,rgba(0,0,0,.6));
transition:.3s;z-index:10}
.overlay.hidden{opacity:0;pointer-events:none}
.top{display:flex;justify-content:space-between;padding:15px 20px}
.top i{font-size:20px;cursor:pointer}
.center{display:flex;justify-content:center;align-items:center}
.play{font-size:60px;cursor:pointer}
.bottom{padding:0 20px 20px}
.live{display:flex;justify-content:flex-end;font-size:11px;font-weight:700;color:#ff2d2d;margin-bottom:8px}
.live span{width:6px;height:6px;background:#ff2d2d;border-radius:50%;margin-right:6px}
.progress{height:20px;cursor:pointer}
.bar{height:3px;background:rgba(255,255,255,.2);border-radius:2px}
.fill{height:100%;width:0;background:var(--p)}
#loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
width:40px;height:40px;border:4px solid rgba(0,120,255,.2);
border-top-color:var(--p);border-radius:50%;animation:spin .8s linear infinite;display:none;z-index:50}
@keyframes spin{to{transform:rotate(360deg)}}
#toast{position:absolute;top:15%;left:50%;transform:translateX(-50%);
background:var(--p);padding:8px 18px;border-radius:20px;opacity:0;transition:.3s;z-index:200}
</style>
</head>

<body>

<div class="player" id="player">
    <div id="loader"></div>
    <div id="toast"></div>

    <video id="video" playsinline webkit-playsinline crossorigin="anonymous"></video>

    <div class="overlay" id="ui">
        <div class="top">
            <i class="fas fa-arrow-left" onclick="history.back()"></i>
            <i class="fas fa-expand" onclick="toggleFS()"></i>
        </div>

        <div class="center" onclick="togglePlay()">
            <i class="fas fa-pause play" id="icon"></i>
        </div>

        <div class="bottom">
            <div class="live"><span></span>LIVE</div>
            <div class="progress" id="progress">
                <div class="bar"><div class="fill" id="fill"></div></div>
            </div>
        </div>
    </div>
</div>

<script>
const video=document.getElementById("video");
const player=document.getElementById("player");
const fill=document.getElementById("fill");
const loader=document.getElementById("loader");
const toast=document.getElementById("toast");
const icon=document.getElementById("icon");

let uiTimer;

// ✅ URL PARAM LOGIC (IMPORTANT)
const params=new URLSearchParams(window.location.search);
let src=params.get("src");

// fallback if no src
if(!src){
    src="https://sp-cric.wasmer.app/proxy.php?url=https%3A%2F%2Fd7.merichunidya.com%3A1686%2Fhls%2Fstar1in.m3u8";
}

// decode if encoded
try{src=decodeURIComponent(src);}catch(e){}

// ✅ HLS CONFIG (PROXY + DIRECT SAFE)
const hls=new Hls({
    lowLatencyMode:true,
    enableWorker:true,
    backBufferLength:90,
    maxBufferLength:30,
    xhrSetup:(xhr)=>{
        xhr.withCredentials=false;
        xhr.setRequestHeader("Accept","*/*");
    }
});

if(Hls.isSupported()){
    hls.loadSource(src);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play().catch(()=>{}));
    hls.on(Hls.Events.FRAG_BUFFERING,()=>loader.style.display="block");
    hls.on(Hls.Events.FRAG_BUFFERED,()=>loader.style.display="none");

    hls.on(Hls.Events.ERROR,(e,d)=>{
        if(d.fatal){
            if(d.type==="networkError") hls.startLoad();
            else if(d.type==="mediaError") hls.recoverMediaError();
            else hls.destroy();
        }
    });
}else{
    video.src=src;
    video.play().catch(()=>{});
}

// UI / PLAY
function togglePlay(){
    if(video.paused) video.play();
    else video.pause();
    icon.className=video.paused?"fas fa-play play":"fas fa-pause play";
}

// LIVE SAFE PROGRESS
video.addEventListener("timeupdate",()=>{
    if(!isFinite(video.duration)) return;
    fill.style.width=(video.currentTime/video.duration)*100+"%";
});

document.getElementById("progress").onclick=e=>{
    if(!isFinite(video.duration)){
        showToast("LIVE – seek disabled");
        return;
    }
    const r=e.currentTarget.getBoundingClientRect();
    video.currentTime=((e.clientX-r.left)/r.width)*video.duration;
};

// FULLSCREEN
function toggleFS(){
    if(!document.fullscreenElement) player.requestFullscreen();
    else document.exitFullscreen();
}

// UI AUTO HIDE
player.onclick=()=>{
    ui.classList.remove("hidden");
    clearTimeout(uiTimer);
    if(!video.paused){
        uiTimer=setTimeout(()=>ui.classList.add("hidden"),4000);
    }
};

// TOAST
function showToast(m){
    toast.innerText=m;
    toast.style.opacity=1;
    setTimeout(()=>toast.style.opacity=0,2000);
}

// ANDROID TV / REMOTE
document.addEventListener("keydown",e=>{
    switch(e.key){
        case "Enter": togglePlay(); break;
        case "ArrowUp": video.volume=Math.min(video.volume+.1,1); break;
        case "ArrowDown": video.volume=Math.max(video.volume-.1,0); break;
    }
});
</script>

</body>
</html>
